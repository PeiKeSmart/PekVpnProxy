# SharpTunTest 快速入门指南

本指南将帮助您快速设置和使用 SharpTunTest 工具，将网络流量通过 SOCKS5 代理转发。

## 准备工作

1. **确保您有一个可用的 SOCKS5 代理服务器**
   - 记下代理服务器的地址、端口和认证信息（如果有）
   - 确保代理服务器正常工作

2. **准备 WinTun 驱动**
   - 确保 `wintun.dll` 文件位于程序目录中
   - 如果没有，请从 [WinTun 官网](https://www.wintun.net/) 下载

## 步骤 1：启动程序

以管理员身份运行 `SharpTunTest.exe`：

1. 右键点击 `SharpTunTest.exe`
2. 选择"以管理员身份运行"
3. 如果出现 UAC 提示，点击"是"

## 步骤 2：配置程序

1. **选择测试模式**
   - 输入 `2` 选择 SOCKS5 代理模式

2. **配置 SOCKS5 代理**
   - 输入代理服务器地址（例如：`127.0.0.1`）
   - 输入代理服务器端口（例如：`1080`）
   - 如果需要认证，输入用户名和密码
   - 选择是否处理 ICMP 流量（输入 `y` 或 `n`）

## 步骤 3：配置路由

程序会自动配置虚拟网络适配器和路由规则。当询问是否要路由所有流量时：

- 输入 `y` 将所有互联网流量通过代理转发
- 输入 `n` 仅转发特定目标（如 Google DNS 和 Cloudflare DNS）的流量

## 步骤 4：测试连接

配置完成后，您可以测试连接是否正常工作：

1. 打开浏览器，访问 [https://www.whatismyip.com/](https://www.whatismyip.com/)
2. 如果显示的 IP 地址是您的代理服务器 IP，说明配置成功
3. 您也可以尝试 ping 8.8.8.8 来测试 ICMP 流量（如果启用了 ICMP 处理）

## 步骤 5：使用和监控

程序运行期间：

- 控制台窗口会显示捕获和转发的流量信息
- 您可以正常使用网络，所有（或指定的）流量都会通过 SOCKS5 代理
- 如果遇到问题，请查看控制台输出的错误信息

## 步骤 6：退出程序

完成使用后：

1. 在程序窗口中按 `Ctrl+C`
2. 程序会自动清理所有资源，包括：
   - 关闭所有连接
   - 删除添加的路由规则
   - 重置网络适配器配置

## 常见问题快速解决

1. **无法创建虚拟适配器**
   - 确保以管理员身份运行程序
   - 确保 `wintun.dll` 文件位于程序目录中

2. **无法连接到网络**
   - 确保 SOCKS5 代理服务器正常工作
   - 检查代理服务器的地址和端口是否正确

3. **程序退出后网络异常**
   - 手动删除路由：`route delete 0.0.0.0`
   - 重启网络适配器或重启计算机

## 命令参考

如果自动配置失败，您可能需要手动运行以下命令：

```
# 配置虚拟适配器 IP
netsh interface ip set address name="SharpTunTest" static 192.168.56.1 255.255.255.0

# 添加代理服务器的直接路由
route add [代理服务器IP] mask 255.255.255.255 [默认网关IP]

# 添加全局路由
route add 0.0.0.0 mask 0.0.0.0 192.168.56.1

# 或添加特定目标路由
route add 8.8.8.8 mask 255.255.255.255 192.168.56.1
route add 1.1.1.1 mask 255.255.255.255 192.168.56.1
```

更多详细信息，请参阅完整的 README.md 文档。
